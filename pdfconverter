// 安裝NuGet包：itext7, itext7.pdfrender
using iText.Kernel.Pdf;
using iText.Kernel.Pdf.Canvas.Parser;
using iText.Pdfrender;

public static void ConvertPdfToPngUsingIText7(string pdfPath, string outputFolder, int dpi = 300)
{
    if (!File.Exists(pdfPath))
        throw new FileNotFoundException("找不到指定的PDF文件", pdfPath);
    
    if (!Directory.Exists(outputFolder))
        Directory.CreateDirectory(outputFolder);
    
    using (PdfDocument pdfDoc = new PdfDocument(new PdfReader(pdfPath)))
    {
        int pageCount = pdfDoc.GetNumberOfPages();
        Console.WriteLine($"PDF文件共有 {pageCount} 頁");
        
        for (int i = 1; i <= pageCount; i++)
        {
            PdfPage page = pdfDoc.GetPage(i);
            PdfRendererBuilder builder = new PdfRendererBuilder();
            builder.Scale(dpi / 72f);
            
            using (var renderer = builder.Build())
            {
                var image = renderer.RenderPageToImage(page);
                string outputPath = Path.Combine(outputFolder, $"page-{i}.png");
                image.Save(outputPath, System.Drawing.Imaging.ImageFormat.Png);
                Console.WriteLine($"已保存: {outputPath}");
            }
        }
    }
}